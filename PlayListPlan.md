# プレイリスト実装計画

## 概要
現在の再生キューをプレイリスト機能に拡張し、複数のプレイリストを管理できるようにする。
タブ形式で「デフォルト」プレイリスト（固定）とユーザー作成プレイリストを管理する。

## 実装ステップ

### Phase 1: 基本データ構造とプレイリスト管理
- **Step 1-1**: プレイリストの基本データ構造を作成
  - `src/playlist/mod.rs` 作成
  - `Playlist` 構造体定義
  - `PlaylistManager` 構造体定義
  - 基本的なCRUD操作メソッド

- **Step 1-2**: プレイリストの永続化機能
  - `src/playlist/persistence.rs` 作成
  - JSON形式でのプレイリスト保存・読み込み
  - デフォルトプレイリストの自動作成

- **Step 1-3**: 既存のPlaybackQueueをPlaylistManagerに置き換え
  - `main.rs`での`PlaybackQueue`を`PlaylistManager`に変更
  - 現在の再生キューデータをデフォルトプレイリストとして移行
  - 基本的な楽曲追加・削除機能の動作確認

### Phase 2: プレイリストタブUI実装
- **Step 2-1**: 動的タブUI基本実装
  - カスタムタブ描画機能作成
  - デフォルトタブの固定表示
  - タブ切り替え機能

- **Step 2-2**: プレイリスト作成・削除機能
  - 新規プレイリスト作成（+ボタン）
  - プレイリスト削除（右クリックメニュー）
  - アクティブプレイリストの管理

- **Step 2-3**: プレイリスト名前変更機能
  - インライン編集機能
  - Enter/Escapeキーでの編集確定・キャンセル
  - 重複名チェック

### Phase 3: プレイリスト操作機能
- **Step 3-1**: 楽曲のプレイリスト間移動
  - 楽曲ライブラリからの複数プレイリストへの追加
  - コンテキストメニューでのプレイリスト選択
  - ドラッグ&ドロップ（可能であれば）

- **Step 3-2**: プレイリスト内楽曲操作の改善
  - 複数選択機能の維持
  - 楽曲順序変更機能
  - プレイリスト間での楽曲コピー・移動

- **Step 3-3**: 再生機能の調整
  - アクティブプレイリストからの再生
  - プレイリスト切り替え時の再生状態管理
  - 現在再生中楽曲の視覚的表示

### Phase 4: 設定とエラーハンドリング
- **Step 4-1**: 設定機能の拡張
  - 最後に使用したプレイリストの記憶
  - プレイリスト表示順序の保存
  - デフォルトプレイリストの動作設定

- **Step 4-2**: エラーハンドリングと検証
  - 不正なプレイリストファイルの処理
  - 存在しない楽曲ファイルの処理
  - プレイリスト名の重複・空文字チェック

- **Step 4-3**: パフォーマンス最適化
  - 大量楽曲でのプレイリスト読み込み最適化
  - メモリ使用量の最適化
  - UI応答性の改善

### Phase 5: 最終調整と拡張機能
- **Step 5-1**: UI/UXの改善
  - プレイリストの視覚的表示改善
  - ツールチップやヘルプテキスト追加
  - キーボードショートカット追加

- **Step 5-2**: 高度な機能（オプション）
  - プレイリストのインポート・エクスポート
  - プレイリストの並び替え機能
  - 楽曲重複チェック機能

## ファイル構造

### 新規作成ファイル
```
src/
├── playlist/
│   ├── mod.rs           # プレイリスト関連の公開API
│   ├── manager.rs       # PlaylistManager実装
│   └── persistence.rs   # JSON保存・読み込み
└── ui/
    └── playlist_tabs.rs # プレイリストタブUI
```

### 主要変更ファイル
- `src/main.rs` - PlaybackQueueからPlaylistManagerへの移行
- `src/player/queue.rs` - 再生キューロジックの簡素化
- `src/ui/playback_controls.rs` - プレイリストUIとの統合

## データ構造概要

```rust
struct Playlist {
    id: String,
    name: String,
    tracks: Vec<TrackInfo>,
    created_at: SystemTime,
    modified_at: SystemTime,
}

struct PlaylistManager {
    playlists: Vec<Playlist>,
    active_playlist_id: String,
    selected_indices: HashSet<usize>,
    current_playing_index: Option<usize>,
}
```

## 注意点
- 各ステップ完了後にコンパイル・動作確認を行う
- 既存機能を破壊しないよう段階的に移行
- バックアップとして現在のコードを保持
- テスト用のサンプルプレイリストを用意

## 開始コマンド
各ステップ開始時に以下のように指示してください：
```
Step X-Y を実装してください
```